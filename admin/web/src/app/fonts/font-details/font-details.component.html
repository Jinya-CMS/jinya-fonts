@if (loading) {
  <app-loading-spinner />
}
@defer (when !loading) {
  <div class="cosmo-side-list">
    <nav class="cosmo-side-list__items">
      <a
        [routerLink]="['/font/detail', fontName, 'details']"
        (click)="changeSideItem($event, ActiveSideListItem.Details)"
        class="cosmo-side-list__item"
        [class.is--active]="activeSideListItem === ActiveSideListItem.Details"
        i18n
        >Details</a
      >
      <a
        [routerLink]="['/font/detail', fontName, 'designer']"
        (click)="changeSideItem($event, ActiveSideListItem.Designers)"
        class="cosmo-side-list__item"
        [class.is--active]="activeSideListItem === ActiveSideListItem.Designers"
        i18n
        >Designer</a
      >
      <a
        [routerLink]="['/font/detail', fontName, 'file']"
        (click)="changeSideItem($event, ActiveSideListItem.Files)"
        class="cosmo-side-list__item"
        [class.is--active]="activeSideListItem === ActiveSideListItem.Files"
        i18n
        >Dateien</a
      >
    </nav>
    <div class="cosmo-side-list__content">
      @switch (activeSideListItem) {
        @case (ActiveSideListItem.Details) {
          <span class="cosmo-title" i18n>{{ font.name }} – Details</span>
          @if (!font.googleFont) {
            <div class="cosmo-toolbar">
              <div class="cosmo-toolbar__group">
                <button class="cosmo-button" (click)="editFontDialog.open()" i18n>Bearbeiten</button>
                <button class="cosmo-button" (click)="deleteFontOpen = true" i18n>Löschen</button>
              </div>
            </div>
          }
          <dl class="cosmo-list is--key-value">
            <dt i18n>Lizenz</dt>
            <dd>
              @switch (font.license) {
                @case ('apache2') {
                  <a target="_blank" href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>
                }
                @case ('ofl') {
                  <a target="_blank" href="https://openfontlicense.org/">Open Font License</a>
                }
                @case ('ufl') {
                  <a target="_blank" href="https://font.ubuntu.com/ufl/">Ubuntu Font License</a>
                }
                @default {
                  {{ font.license }}
                }
              }
            </dd>
            <dt i18n>Kategorie</dt>
            <dd>{{ font.category }}</dd>
            <dt i18n>Google Font</dt>
            <dd>
              @if (font.googleFont) {
                <lucide-icon [img]="Check" />
              } @else {
                <lucide-icon [img]="X" />
              }
            </dd>
            <h4 i18n>Beschreibung</h4>
            <div [innerHtml]="font.description"></div>
          </dl>
        }
        @case (ActiveSideListItem.Designers) {
          <span class="cosmo-title" i18n>{{ font.name }} – Designer</span>
          <div class="cosmo-tab">
            <div class="cosmo-tab__links">
              @for (designer of font.designers; track designer) {
                <a
                  href="#"
                  class="cosmo-tab__link"
                  (click)="selectDesigner($event, designer)"
                  [class.is--active]="activeDesigner?.name === designer.name"
                  >{{ designer.name }}</a
                >
              }
              @if (!font.googleFont) {
                <a
                  href="#"
                  class="cosmo-tab__link"
                  (click)="selectDesigner($event, null)"
                  [class.is--active]="activeDesigner === null"
                  i18n
                  >Neuer Designer</a
                >
              }
            </div>
            <div class="cosmo-tab__content">
              @if (activeDesigner) {
                @if (!font.googleFont) {
                  <div class="cosmo-toolbar">
                    <div class="cosmo-toolbar__group">
                      <button class="cosmo-button" [disabled]="editDesignerOn" (click)="editDesignerOn = true" i18n>
                        Bearbeiten
                      </button>
                      <button class="cosmo-button" (click)="removeDesignerOpen = true" i18n>Löschen</button>
                    </div>
                  </div>
                }
                @if (editDesignerOn) {
                  <form class="top-gap" (ngSubmit)="updateNewDesigner()" [formGroup]="editDesignerForm">
                    <editor
                      class="tiny-editor"
                      [init]="{ base_url: '/admin/tinymce', suffix: '.min', height: 250 }"
                      formControlName="bio"
                    ></editor>
                    <div class="cosmo-button__container">
                      <button class="cosmo-button" (click)="editDesignerOn = false" type="reset">
                        Änderungen verwerfen
                      </button>
                      <button class="cosmo-button is--primary" type="submit">Designer speichern</button>
                    </div>
                  </form>
                } @else {
                  <div [innerHtml]="activeDesigner.bio"></div>
                }
              } @else {
                <form (ngSubmit)="createNewDesigner()" [formGroup]="addDesignerForm">
                  <fieldset class="jinya-fieldset">
                    <legend class="jinya-legend">Designer hinzufügen</legend>
                    <div class="cosmo-input__group">
                      <label for="designerName" class="cosmo-label">Name</label>
                      <input type="text" id="designerName" class="cosmo-input" required formControlName="name" />
                      <span
                        class="cosmo-input__message is--negative"
                        [class.is--hidden]="!addDesignerForm.get('name')?.invalid"
                        i18n
                        >Du musst einen Namen angeben</span
                      >
                      <span class="cosmo-label" i18n>Über den Designer</span>
                      <editor
                        class="tiny-editor"
                        [init]="{ base_url: '/admin/tinymce', suffix: '.min', height: 250 }"
                        formControlName="bio"
                      ></editor>
                    </div>
                    <div class="cosmo-button__container">
                      <button class="cosmo-button" type="reset">Änderungen verwerfen</button>
                      <button class="cosmo-button is--primary" type="submit">Designer hinzufügen</button>
                    </div>
                  </fieldset>
                </form>
              }
            </div>
          </div>
        }
        @case (ActiveSideListItem.Files) {
          <span class="cosmo-title" i18n>{{ font.name }} – Dateien</span>
          @if (!font.googleFont) {
            <div class="cosmo-toolbar">
              <div class="cosmo-toolbar__group">
                <button class="cosmo-button" (click)="addFileDialog.open = true" i18n>Datei hochladen</button>
              </div>
            </div>
          }
          <table class="cosmo-table">
            <thead>
              <tr>
                <th i18n>Stil</th>
                <th i18n>Stärke</th>
                <th i18n>Dateityp</th>
                <th i18n>Aktionen</th>
              </tr>
            </thead>
            <tbody>
              @for (file of font.fonts; track file) {
                <tr>
                  <td>{{ file.style }}</td>
                  <td>{{ file.weight }}</td>
                  <td>{{ file.type }}</td>
                  <td>
                    <div class="cosmo-toolbar__group">
                      <a href="{{ file.path }}" class="cosmo-button" i18n>Download</a>
                      @if (!font.googleFont) {
                        <button class="cosmo-button" (click)="openEditFile(file)" i18n>Bearbeiten</button>
                        <button class="cosmo-button" (click)="openDeleteFile(file)" i18n>Löschen</button>
                      }
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        }
      }
    </div>
  </div>
  <app-edit-font-dialog [font]="font" (saved)="loadData()" #editFontDialog />
  <app-add-file-dialog [font]="font" (saved)="loadData()" #addFileDialog />
  @if (activeFile) {
    <app-update-file-dialog [open]="editFileOpen" [font]="font" [file]="activeFile" (saved)="loadData()" />
  }
  <app-confirm
    [open]="deleteFontOpen"
    title="Font löschen"
    confirmLabel="Font löschen"
    declineLabel="Font nicht löschen"
    [negative]="true"
    (decline)="deleteFontOpen = false"
    (confirm)="deleteFont()"
    i18n
    i18n-title
    i18n-declineLabel
    i18n-confirmLabel
  >
    Soll der Font {{ font.name }} wirklich gelöscht werden?
  </app-confirm>
  <app-confirm
    [open]="removeDesignerOpen"
    title="Designer entfernen"
    confirmLabel="Designer entfernen"
    declineLabel="Designer nicht entfernen"
    [negative]="true"
    (decline)="removeDesignerOpen = false"
    (confirm)="removeDesigner()"
    i18n
    i18n-title
    i18n-declineLabel
    i18n-confirmLabel
  >
    Soll der Designer {{ activeDesigner?.name }} wirklich entfernt werden?
  </app-confirm>
  <app-confirm
    [open]="removeFileOpen"
    title="Datei entfernen"
    confirmLabel="Datei entfernen"
    declineLabel="Datei nicht entfernen"
    [negative]="true"
    (decline)="removeFileOpen = false"
    (confirm)="removeFile()"
    i18n
    i18n-title
    i18n-declineLabel
    i18n-confirmLabel
  >
    Soll die {{ activeFile?.type?.toUpperCase() }}-Datei mit der Stärke
    @switch (activeFile?.weight) {
      @case ('100') {
        Ultraleicht (100)
      }
      @case ('200') {
        Extraleicht (200)
      }
      @case ('300') {
        Mager (300)
      }
      @case ('400') {
        Normal (400)
      }
      @case ('500') {
        Leichthalbfett (500)
      }
      @case ('600') {
        Fett (600)
      }
      @case ('700') {
        Halbfett (700)
      }
      @case ('800') {
        Extafett (800)
      }
      @case ('900') {
        Ultrafett (900)
      }
      @default {
        {{ activeFile?.weight }}
      }
    }
    im Stil
    @if (activeFile?.style === 'italic') {
      Kursiv
    } @else {
      Normal
    }
  </app-confirm>
}
