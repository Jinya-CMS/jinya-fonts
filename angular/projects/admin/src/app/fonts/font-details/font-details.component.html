@if (loading) {
  <app-loading-spinner />
}
@defer (when !loading) {
  <div class="cosmo-side-list">
    <nav class="cosmo-side-list__items">
      <a
        [routerLink]="['/font/detail', fontName, 'details']"
        (click)="changeSideItem($event, ActiveSideListItem.Details)"
        class="cosmo-side-list__item"
        [class.is--active]="activeSideListItem === ActiveSideListItem.Details"
        i18n="@@font-details-details"
      >
        Details
      </a>
      <a
        [routerLink]="['/font/detail', fontName, 'designer']"
        (click)="changeSideItem($event, ActiveSideListItem.Designers)"
        class="cosmo-side-list__item"
        [class.is--active]="activeSideListItem === ActiveSideListItem.Designers"
        i18n="@@font-details-designer"
      >
        Designers
      </a>
      <a
        [routerLink]="['/font/detail', fontName, 'file']"
        (click)="changeSideItem($event, ActiveSideListItem.Files)"
        class="cosmo-side-list__item"
        [class.is--active]="activeSideListItem === ActiveSideListItem.Files"
        i18n="@@font-details-files"
      >
        Files
      </a>
    </nav>
    <div class="cosmo-side-list__content">
      @switch (activeSideListItem) {
        @case (ActiveSideListItem.Details) {
          <span class="cosmo-title" i18n="@@font-details-details-title">{{ font.name }} – Details</span>
          @if (!font.googleFont) {
            <div class="cosmo-toolbar">
              <div class="cosmo-toolbar__group">
                <button class="cosmo-button" (click)="editFontDialog.open()" i18n="@@edit">Edit</button>
                <button class="cosmo-button" (click)="deleteFontOpen = true" i18n="@@delete">Delete</button>
              </div>
            </div>
          }
          <dl class="cosmo-list is--key-value">
            <dt i18n="@@font-license">License</dt>
            <dd>
              @switch (font.license) {
                @case ('apache2') {
                  <a target="_blank" href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>
                }
                @case ('ofl') {
                  <a target="_blank" href="https://openfontlicense.org/">Open Font License</a>
                }
                @case ('ufl') {
                  <a target="_blank" href="https://font.ubuntu.com/ufl/">Ubuntu Font License</a>
                }
                @default {
                  {{ font.license }}
                }
              }
            </dd>
            <dt i18n="@@font-category">Category</dt>
            <dd>{{ font.category }}</dd>
            <dt i18n="@@font-google-font">Google Font</dt>
            <dd>
              @if (font.googleFont) {
                <lucide-icon [img]="Check" />
              } @else {
                <lucide-icon [img]="X" />
              }
            </dd>
            <h4 i18n="@@font-description">Description</h4>
            <div [innerHtml]="font.description"></div>
          </dl>
        }
        @case (ActiveSideListItem.Designers) {
          <span class="cosmo-title" i18n="@@font-details-designer-title">{{ font.name }} – Designers</span>
          <div class="cosmo-tab">
            <div class="cosmo-tab__links">
              @for (designer of font.designers; track designer) {
                <a
                  href="#"
                  class="cosmo-tab__link"
                  (click)="selectDesigner($event, designer)"
                  [class.is--active]="activeDesigner?.name === designer.name"
                >
                  {{ designer.name }}
                </a>
              }
              @if (!font.googleFont) {
                <a
                  href="#"
                  class="cosmo-tab__link"
                  (click)="selectDesigner($event, null)"
                  [class.is--active]="activeDesigner === null"
                  i18n="@@font-details-new-designer"
                >
                  New designer
                </a>
              }
            </div>
            <div class="cosmo-tab__content">
              @if (activeDesigner) {
                @if (!font.googleFont) {
                  <div class="cosmo-toolbar">
                    <div class="cosmo-toolbar__group">
                      <button
                        class="cosmo-button"
                        [disabled]="editDesignerOn"
                        (click)="editDesignerOn = true"
                        i18n="@@edit"
                      >
                        Edit
                      </button>
                      <button class="cosmo-button" (click)="removeDesignerOpen = true" i18n="@@delete">Delete</button>
                    </div>
                  </div>
                }
                @if (editDesignerOn) {
                  <form class="top-gap" (ngSubmit)="updateNewDesigner()" [formGroup]="editDesignerForm">
                    <editor
                      class="tiny-editor"
                      [init]="{ base_url: '/admin/tinymce', suffix: '.min', height: 250 }"
                      formControlName="bio"
                    ></editor>
                    <div class="cosmo-button__container">
                      <button
                        class="cosmo-button"
                        (click)="editDesignerOn = false"
                        type="reset"
                        i18n="@@discard-changes"
                      >
                        Discard changes
                      </button>
                      <button class="cosmo-button is--primary" type="submit" i18n="@@save-designer">
                        Save designer
                      </button>
                    </div>
                  </form>
                } @else {
                  <div [innerHtml]="activeDesigner.bio"></div>
                }
              } @else {
                <form (ngSubmit)="createNewDesigner()" [formGroup]="addDesignerForm">
                  <fieldset class="jinya-fieldset">
                    <legend class="jinya-legend" i18n="@@create-designer">Create designer</legend>
                    <div class="cosmo-input__group">
                      <label for="designerName" class="cosmo-label" i18n="@@designer-name-label">Name</label>
                      <input type="text" id="designerName" class="cosmo-input" required formControlName="name" />
                      <span
                        class="cosmo-input__message is--negative"
                        [class.is--hidden]="!addDesignerForm.get('name')?.invalid"
                        i18n="@@designer-name-error"
                      >
                        You need to enter a name
                      </span>
                      <span class="cosmo-label" i18n="@@about-designer">About the designer</span>
                      <editor
                        class="tiny-editor"
                        [init]="{ base_url: '/admin/tinymce', suffix: '.min', height: 250 }"
                        formControlName="bio"
                      ></editor>
                    </div>
                    <div class="cosmo-button__container">
                      <button class="cosmo-button" type="reset" i18n="@@discard-changes">Discard changes</button>
                      <button class="cosmo-button is--primary" type="submit" i18n="@@create-designer">
                        Create designer
                      </button>
                    </div>
                  </fieldset>
                </form>
              }
            </div>
          </div>
        }
        @case (ActiveSideListItem.Files) {
          <span class="cosmo-title" i18n="@@font-details-files-title">{{ font.name }} – Files</span>
          @if (!font.googleFont) {
            <div class="cosmo-toolbar">
              <div class="cosmo-toolbar__group">
                <button class="cosmo-button" (click)="addFileDialog.open = true" i18n="@@upload-file">
                  Upload file
                </button>
              </div>
            </div>
          }
          <table class="cosmo-table">
            <thead>
              <tr>
                <th i18n="@@font-style">Style</th>
                <th i18n="@@font-weight">Weight</th>
                <th i18n="@@font-file-type">File type</th>
                <th i18n="@@actions">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (file of font.fonts; track file) {
                <tr>
                  <td>{{ file.style }}</td>
                  <td>{{ file.weight }}</td>
                  <td>{{ file.type }}</td>
                  <td>
                    <div class="cosmo-toolbar__group">
                      <a href="{{ file.path }}" class="cosmo-button" i18n="@@download">Download</a>
                      @if (!font.googleFont) {
                        <button class="cosmo-button" (click)="openEditFile(file)" i18n="@@edit">Edit</button>
                        <button class="cosmo-button" (click)="openDeleteFile(file)" i18n="@@delete">Delete</button>
                      }
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        }
      }
    </div>
  </div>
  <app-edit-font-dialog [font]="font" (saved)="loadData()" #editFontDialog />
  <app-add-file-dialog [font]="font" (saved)="loadData()" #addFileDialog />
  @if (activeFile) {
    <app-update-file-dialog [open]="editFileOpen" [font]="font" [file]="activeFile" (saved)="loadData()" />
  }
  <app-confirm
    [open]="deleteFontOpen"
    title="Delete font"
    confirmLabel="Delete font"
    declineLabel="Keep font"
    [negative]="true"
    (decline)="deleteFontOpen = false"
    (confirm)="deleteFont()"
    i18n="@@delete-font-message"
    i18n-title="@@delete-font-title"
    i18n-declineLabel="@@delete-font-decline-label"
    i18n-confirmLabel="@@delete-font-confirm-label"
  >
    Do you really want to delete the font {{ font.name }}?
  </app-confirm>
  <app-confirm
    [open]="removeDesignerOpen"
    title="Remove designer"
    confirmLabel="Remove designer"
    declineLabel="Keep designer"
    [negative]="true"
    (decline)="removeDesignerOpen = false"
    (confirm)="removeDesigner()"
    i18n="@@delete-designer-message"
    i18n-title="@@delete-designer-title"
    i18n-declineLabel="@@delete-designer-decline-label"
    i18n-confirmLabel="@@delete-designer-confirm-label"
  >
    Do you really want to delete the designer {{ activeDesigner?.name }}?
  </app-confirm>
  <app-confirm
    [open]="removeFileOpen"
    title="Remove file"
    confirmLabel="Remove file"
    declineLabel="Keep file"
    [negative]="true"
    (decline)="removeFileOpen = false"
    (confirm)="removeFile()"
    i18n="@@delete-file-message"
    i18n-title="@@delete-file-title"
    i18n-declineLabel="@@delete-file-decline-label"
    i18n-confirmLabel="@@delete-file-confirm-label"
  >
    Do you really want to remove the {{ activeFile?.type?.toUpperCase() }}-file with a weight of
    @switch (activeFile?.weight) {
      @case ('100') {
        thin (100)
      }
      @case ('200') {
        extra light (200)
      }
      @case ('300') {
        light (300)
      }
      @case ('400') {
        normal (400)
      }
      @case ('500') {
        medium (500)
      }
      @case ('600') {
        bold (600)
      }
      @case ('700') {
        semi bold (700)
      }
      @case ('800') {
        extra bold (800)
      }
      @case ('900') {
        black (900)
      }
      @default {
        {{ activeFile?.weight }}
      }
    }
    in font style
    @if (activeFile?.style === 'italic') {
      italic
    } @else {
      normal
    }
  </app-confirm>
}
